# AWE Learner Agent

The **Learner Agent** provides the "memory" and "improvement" capabilities of the framework. It analyzes successful extractions to identify patterns, allowing the system to become faster and cheaper over time by replacing expensive LLM calls with direct CSS selectors.

## ðŸ§  Core Concept: Knowledge Distillation

The Learner's goal is to **distill** the one-off success of an LLM extraction into a repeatable, deterministic rule (a "Pattern").

1.  **Observe**: Watch the Extractor successfully pull data from a page (often using an LLM).
2.  **Analyze**: Look at the HTML and the extracted data to reverse-engineer *which* DOM elements contained that data.
3.  **Generalize**: Create a selector (e.g., `h1.faculty-name`) that works for that specific domain.
4.  **Save**: Store this pattern in the Knowledge Graph.
5.  **Apply**: Future visits to that domain use the pattern immediately, bypassing the LLM.

## ðŸ› ï¸ Technical Implementation

The Learner is implemented in `learner.py`.

### 1. `LearnedPattern`
The core data structure representing a site-specific rule.
*   `site_domain`: The domain this applies to (e.g., `cs.university.edu`).
*   `selectors`: A map of fields to their best CSS selector (e.g., `name` -> `.profile-header h1`).
*   `extraction_methods`: How to pull the data (text, href, src, list).
*   `success_rate`: Tracked over time to deprecate broken patterns.

### 2. `LearnerAgent`
The agent responsible for the learning loop.

*   `learn_from_results`: Takes a batch of `ExtractionResult`s, groups them by domain, and finds commonalities.
*   `_find_selector_for_value`: Heuristic logic that searches the DOM for an element containing a specific string value, verifying it as the source.
*   `generate_playwright_template`: Converts a `LearnedPattern` into a standalone, executable Python script using Playwright.

## ðŸ”„ The Learning Loop

1.  **Input**: The Orchestrator passes a list of `ExtractionResult` objects to the Learner at the end of a run.
2.  **Filter**: It discards invalid or low-confidence results.
3.  **Group**: Results are grouped by domain.
4.  **Pattern Match**:
    *   For each field (email, name, bio), it scans the DOM to find the *simplest unique selector* that points to the extracted value.
    *   It requires consistency across multiple samples (if available) to confirm a pattern.
5.  **Persist**: The new `LearnedPattern` is saved to `patterns.json`.

## ðŸ“¤ Code Generation
A unique feature of the Learner is **Code Generation**. It can export a specialized scraper for a specific site:

```python
# Generated by LearnerAgent
async with async_playwright() as p:
    # ... setup ...
    data = {}
    data['name'] = await page.inner_text("h1.name")
    data['email'] = await page.get_attribute("a.email", "href")
    # ...
```

This allows users to "graduate" a scraper from the general-purpose agent to a dedicated, high-performance script.

## ðŸ“¦ Libraries & Dependencies

| Library | Purpose |
| :--- | :--- |
| **`urllib.parse`** | Domain extraction and URL manipulation. |
| **`json`** | Pattern persistence. |
| **`datetime`** | Versioning and timestamping patterns. |
| **`os`** | File system operations for saving templates. |
